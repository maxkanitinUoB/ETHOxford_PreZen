<!-- chat.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PreZen | Chat</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #7c3aed;
      --accent: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;

      --dark: #0f172a;
      --light: #f8fafc;

      --gray: #64748b;
      --gray-light: #e2e8f0;

      --border-radius: 12px;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.10), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --transition: all 0.3s ease;

      /* Light chat theme tokens */
      --chat-bg: #f1f5f9;
      --chat-surface: #ffffff;
      --chat-surface-2: #f8fafc;
      --chat-border: #e2e8f0;
      --chat-text: #0f172a;
      --chat-muted: #475569;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: var(--chat-bg);
      display: flex;
      min-height: 100vh;
    }

    h1,
    h2,
    h3,
    h4,
    h5 {
      font-family: "Poppins", sans-serif;
      font-weight: 600;
      line-height: 1.3;
    }

    .container {
      display: flex;
      width: 100%;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background-color: white;
      border-right: 1px solid var(--gray-light);
      padding: 20px;
      height: 100vh;
      position: sticky;
      top: 0;
      overflow-y: auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--gray-light);
    }

    .logo-icon {
      color: var(--secondary);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 30px;
      padding: 15px;
      background-color: #f8fafc;
      border-radius: var(--border-radius);
      border: 1px solid rgba(15, 23, 42, 0.06);
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      background-color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .user-info h3 {
      font-size: 1.1rem;
      margin-bottom: 5px;
    }

    .user-level {
      display: inline-block;
      background-color: var(--accent);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .user-stats {
      display: flex;
      gap: 15px;
      margin-top: 8px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--gray);
    }

    .nav-section {
      margin-bottom: 30px;
    }

    .nav-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 15px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .nav-links {
      list-style: none;
    }

    .nav-links li {
      margin-bottom: 10px;
    }

    .nav-links a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      text-decoration: none;
      color: var(--dark);
      border-radius: var(--border-radius);
      transition: var(--transition);
    }

    .nav-links a:hover,
    .nav-links a.active {
      background-color: #f0f9ff;
      color: var(--primary);
    }

    .nav-links a i {
      width: 20px;
      text-align: center;
    }

    .upgrade-card {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-top: 30px;
    }

    .upgrade-card h4 {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .upgrade-card p {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .upgrade-button {
      background-color: white;
      color: var(--primary);
      border: none;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: var(--transition);
    }

    .upgrade-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Main */
    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      height: 100vh;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      padding-bottom: 18px;
      border-bottom: 1px solid var(--gray-light);
      gap: 14px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--dark);
      font-family: "Poppins", sans-serif;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon-button {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid var(--gray-light);
      background: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      color: var(--dark);
    }

    .icon-button:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
      border-color: #cbd5e1;
    }

    .primary-button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: var(--border-radius);
      font-weight: 800;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: var(--transition);
      white-space: nowrap;
    }

    .primary-button:hover {
      background-color: var(--primary-dark);
    }

    /* Chat shell (light) */
    .chat-shell {
      background: var(--chat-surface);
      border: 1px solid var(--chat-border);
      border-radius: 18px;
      box-shadow: 0 10px 18px -10px rgba(15, 23, 42, 0.10);
      overflow: hidden;
      min-height: calc(100vh - 140px);
    }

    .chat-grid {
      display: grid;
      grid-template-columns: 360px 1fr;
      min-height: calc(100vh - 140px);
    }

    .chat-left {
      border-right: 1px solid var(--chat-border);
      background: var(--chat-surface);
    }

    .chat-right {
      background: var(--chat-bg);
      display: flex;
      flex-direction: column;
    }

    .chat-left-top {
      padding: 16px;
      border-bottom: 1px solid var(--chat-border);
      background: var(--chat-surface);
    }

    /* Search */
    .chat-search {
      position: relative;
    }

    .chat-search input {
      width: 100%;
      padding: 12px 14px 12px 40px;
      border-radius: 999px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      color: var(--chat-text);
      outline: none;
      font-weight: 650;
    }

    .chat-search input::placeholder {
      color: var(--chat-muted);
    }

    .chat-search i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--chat-muted);
    }

    /* Tabs */
    .chat-tabs {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      padding: 6px;
      border-radius: 999px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
    }

    .chat-tab {
      flex: 1;
      text-align: center;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--chat-muted);
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
      font-size: 0.95rem;
      border: 1px solid transparent;
    }

    .chat-tab.active {
      background: var(--chat-surface-2);
      color: var(--chat-text);
      box-shadow: none;
      border: 1px solid rgba(15, 23, 42, 0.06);
    }

    /* List */
    .chat-list {
      padding: 10px;
      overflow-y: auto;
      height: calc(100vh - 140px - 86px);
      background: var(--chat-surface);
    }

    .chat-item {
      width: 100%;
      border: 1px solid transparent;
      background: transparent;
      text-align: left;
      color: var(--chat-text);
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 6px;
    }

    .chat-item:hover {
      background: var(--chat-surface-2);
    }

    .chat-item.active {
      background: rgba(37, 99, 235, 0.10);
      border: 1px solid rgba(37, 99, 235, 0.18);
    }

    .chat-avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      color: white;
      flex: 0 0 auto;
    }

    .chat-item-main {
      flex: 1;
      min-width: 0;
    }

    .chat-item-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .chat-name {
      font-weight: 900;
      font-size: 0.98rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--chat-text);
    }

    .chat-time {
      font-size: 0.8rem;
      color: var(--chat-muted);
      font-weight: 800;
      white-space: nowrap;
    }

    .chat-snippet {
      font-size: 0.9rem;
      color: var(--chat-muted);
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }

    .chat-badge {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--primary);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
      flex: 0 0 auto;
      display: none;
    }

    .chat-item.unread .chat-badge {
      display: inline-block;
    }

    /* Requests */
    .request-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .ghost-button {
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      color: var(--chat-text);
      padding: 9px 10px;
      border-radius: 999px;
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
    }

    .ghost-button:hover {
      background: var(--chat-surface-2);
    }

    .danger-button {
      border: 1px solid rgba(239, 68, 68, 0.25);
      background: rgba(239, 68, 68, 0.08);
      color: var(--danger);
      padding: 9px 10px;
      border-radius: 999px;
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
    }

    .danger-button:hover {
      background: rgba(239, 68, 68, 0.12);
    }

    /* Right header */
    .chat-right-top {
      padding: 14px 16px;
      border-bottom: 1px solid var(--chat-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: var(--chat-surface);
    }

    .chat-peer {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .peer-avatar {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 900;
      flex: 0 0 auto;
    }

    .peer-meta {
      min-width: 0;
    }

    .peer-name {
      font-weight: 900;
      color: var(--chat-text);
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .peer-status {
      font-weight: 700;
      font-size: 0.85rem;
      color: var(--chat-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.12);
    }

    .chat-right-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chat-action-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--chat-text);
      cursor: pointer;
      transition: var(--transition);
    }

    .chat-action-btn:hover {
      background: var(--chat-surface-2);
      transform: translateY(-1px);
    }

    /* Messages */
    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: var(--chat-bg);
    }

    .chat-empty {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      color: var(--chat-muted);
    }

    .empty-card {
      max-width: 420px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 18px -16px rgba(15, 23, 42, 0.12);
    }

    .empty-title {
      font-family: "Poppins", sans-serif;
      font-weight: 900;
      font-size: 1.2rem;
      color: var(--chat-text);
      margin-bottom: 8px;
    }

    .empty-subtitle {
      font-weight: 600;
      color: var(--chat-muted);
    }

    .msg-row {
      display: flex;
      margin-bottom: 12px;
    }

    .msg-row.me {
      justify-content: flex-end;
    }

    .msg-bubble {
      max-width: min(520px, 76%);
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      color: var(--chat-text);
      box-shadow: 0 10px 18px -16px rgba(15, 23, 42, 0.18);
    }

    .msg-row.me .msg-bubble {
      background: rgba(37, 99, 235, 0.10);
      border-color: rgba(37, 99, 235, 0.18);
    }

    .msg-text {
      font-weight: 650;
      font-size: 0.95rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .msg-time {
      margin-top: 6px;
      font-size: 0.75rem;
      font-weight: 800;
      color: var(--chat-muted);
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-end;
    }

    .msg-row.them .msg-time {
      justify-content: flex-start;
    }

    .read-check {
      font-size: 0.9rem;
      color: rgba(37, 99, 235, 0.7);
    }

    /* Input */
    .chat-input {
      padding: 12px 12px;
      border-top: 1px solid var(--chat-border);
      background: var(--chat-surface);
    }

    .input-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      border-radius: 999px;
      padding: 8px 10px;
    }

    .input-icon {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: var(--chat-surface-2);
      color: var(--chat-text);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      flex: 0 0 auto;
    }

    .input-icon:hover {
      background: rgba(15, 23, 42, 0.06);
      transform: translateY(-1px);
    }

    .input-wrap input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--chat-text);
      font-weight: 650;
      font-size: 0.95rem;
      padding: 8px 4px;
      min-width: 0;
    }

    .input-wrap input::placeholder {
      color: var(--chat-muted);
    }

    .send-btn {
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: white;
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      flex: 0 0 auto;
    }

    .send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Community feed */
    .community-feed {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .post-card {
      border: 1px solid var(--chat-border);
      background: var(--chat-surface);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 10px 18px -16px rgba(15, 23, 42, 0.12);
    }

    .post-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .post-title {
      font-weight: 900;
      color: var(--chat-text);
      font-size: 1rem;
      line-height: 1.3;
    }

    .post-meta {
      font-size: 0.8rem;
      font-weight: 800;
      color: var(--chat-muted);
      white-space: nowrap;
    }

    .post-body {
      color: var(--chat-text);
      font-weight: 600;
      font-size: 0.95rem;
      line-height: 1.55;
      white-space: pre-wrap;
    }

    .post-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .mini-btn {
      border: 1px solid var(--chat-border);
      background: var(--chat-surface-2);
      color: var(--chat-text);
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.85rem;
    }

    .mini-btn:hover {
      background: rgba(15, 23, 42, 0.06);
    }

    @media (max-width: 1100px) {
      .chat-grid {
        grid-template-columns: 340px 1fr;
      }
    }

    @media (max-width: 900px) {
      .chat-grid {
        grid-template-columns: 1fr;
      }

      .chat-left {
        border-right: none;
        border-bottom: 1px solid var(--chat-border);
      }

      .chat-list {
        height: auto;
        max-height: 360px;
      }

      .chat-shell {
        min-height: auto;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-chart-line logo-icon"></i>
        <span>PreZen</span>
      </div>

      <div class="user-profile">
        <div class="user-avatar">JD</div>
        <div class="user-info">
          <h3>John Doe</h3>
          <div class="user-level">Level 3 Trader</div>
          <div class="user-stats">
            <div class="stat">
              <div class="stat-value">72%</div>
              <div class="stat-label">Win Rate</div>
            </div>
            <div class="stat">
              <div class="stat-value">$2.1K</div>
              <div class="stat-label">Staked</div>
            </div>
          </div>
        </div>
      </div>

      <div class="nav-section">
        <h4 class="nav-title">Main</h4>
        <ul class="nav-links">
          <li><a href="home.html"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
          <li><a href="trade.html"><i class="fas fa-chart-line"></i> Trade</a></li>
          <li><a class="active" href="chat.html"><i class="fas fa-comments"></i> Chat</a></li>
          <li><a href="notifications.html"><i class="fas fa-bell"></i> Notifications</a></li>
          <li><a href="saved.html"><i class="fas fa-bookmark"></i> Saved</a></li>
          <li><a href="AIsignals.html"><i class="fas fa-robot"></i> AI Signals</a></li>
          <li><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
      </div>

      <div class="upgrade-card">
        <h4>Upgrade to Premium</h4>
        <p>Get smart filtering, reputation-weighted odds, and AI recommendations</p>
        <a class="upgrade-button" href="upgrade.html">Upgrade Now</a>
      </div>
    </aside>

    <main class="main-content">
      <div class="header">
        <div class="header-left">
          <div class="page-title">
            <i class="fa-brands fa-x-twitter" style="color:var(--dark);"></i>
            Chat
          </div>
        </div>

        <div class="header-actions">
          <button class="icon-button" id="settingsBtn" title="Chat settings">
            <i class="fas fa-gear"></i>
          </button>
          <button class="primary-button" id="newMsgBtn">
            <i class="fas fa-pen-to-square"></i> New Message
          </button>
        </div>
      </div>

      <section class="chat-shell">
        <div class="chat-grid">
          <aside class="chat-left">
            <div class="chat-left-top">
              <div class="chat-search">
                <i class="fas fa-search"></i>
                <input id="chatSearch" type="text" placeholder="Search..." autocomplete="off" />
              </div>

              <!-- Tabs: All / Requests / Community -->
              <div class="chat-tabs" role="tablist" aria-label="Chat tabs">
                <div class="chat-tab active" data-tab="all" role="tab" aria-selected="true">All</div>
                <div class="chat-tab" data-tab="requests" role="tab" aria-selected="false">Requests</div>
                <div class="chat-tab" data-tab="community" role="tab" aria-selected="false">Community</div>
              </div>
            </div>

            <div class="chat-list" id="chatList"></div>
          </aside>

          <section class="chat-right">
            <div class="chat-right-top" id="chatHeader" style="display:none;">
              <div class="chat-peer">
                <div class="peer-avatar" id="peerAvatar">A</div>
                <div class="peer-meta">
                  <div class="peer-name" id="peerName">Select</div>
                  <div class="peer-status">
                    <span class="status-dot" id="peerDot"></span>
                    <span id="peerStatus">â€”</span>
                  </div>
                </div>
              </div>

              <div class="chat-right-actions">
                <button class="chat-action-btn" title="Search in chat" id="chatFindBtn">
                  <i class="fas fa-magnifying-glass"></i>
                </button>
                <button class="chat-action-btn" title="Info" id="chatInfoBtn">
                  <i class="fas fa-circle-info"></i>
                </button>
              </div>
            </div>

            <div class="chat-messages" id="chatMessages">
              <div class="chat-empty">
                <div class="empty-card">
                  <div class="empty-title">Pick a conversation</div>
                  <div class="empty-subtitle">Choose a friend on the left to start chatting.</div>
                </div>
              </div>
            </div>

            <div class="chat-input" id="chatInput" style="display:none;">
              <div class="input-wrap">
                <button class="input-icon" id="attachBtn" title="Attach"><i class="fas fa-plus"></i></button>
                <button class="input-icon" id="emojiBtn" title="Emoji"><i class="far fa-face-smile"></i></button>
                <input id="messageInput" type="text" placeholder="Write a message..." />
                <button class="send-btn" id="sendBtn"><i class="fas fa-paper-plane"></i> Send</button>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <script>
    const palette = [
      "#2563eb", "#10b981", "#7c3aed", "#f59e0b", "#ef4444",
      "#0ea5e9", "#22c55e", "#a855f7", "#f97316", "#e11d48"
    ];

    // 1) DMs: talk like traders (risk / trend / entry / exits). "NFA" vibe.
    const chats = [
      {
        id: "alex",
        name: "Alex Mercer",
        initials: "AM",
        color: palette[0],
        status: "Online",
        unread: true,
        time: "10:12 AM",
        snippet: "This looks mispriced, but liquidity is thin â€” limit orders only.",
        messages: [
          { from: "them", text: "Odds feel off. Market implies ~38% but my read is closer to mid-40s.", time: "9:58 AM" },
          { from: "me", text: "Whatâ€™s the catalyst though? If no new info, it can just chop and spread eats you.", time: "10:00 AM" },
          { from: "them", text: "Catalyst: report drop later today. If itâ€™s even slightly positive, prob should drift up.", time: "10:03 AM" },
          { from: "me", text: "Ok, but Iâ€™m sizing small. Iâ€™d rather be early with tiny risk than late with big risk.", time: "10:06 AM" },
          { from: "them", text: "Same. Limit orders + defined invalidation. NFA obviously.", time: "10:10 AM" }
        ]
      },
      {
        id: "maya",
        name: "Maya Sterling",
        initials: "MS",
        color: palette[1],
        status: "Away",
        unread: false,
        time: "9:22 AM",
        snippet: "Trend is up, but headline risk is huge â€” donâ€™t overexpose.",
        messages: [
          { from: "them", text: "This has been grinding up all morning. Feels like momentum is in control.", time: "9:02 AM" },
          { from: "me", text: "Momentum yes, but crowded. One headline and it snaps back fast.", time: "9:06 AM" },
          { from: "them", text: "Iâ€™m treating it as an event trade: tight risk, partial take profit into spikes.", time: "9:10 AM" },
          { from: "me", text: "Good. Also check liquidity â€” if the book is thin, exits get ugly.", time: "9:16 AM" },
          { from: "them", text: "Agreed. Only taking entries where I can realistically exit with limits.", time: "9:21 AM" }
        ]
      },
      {
        id: "noah",
        name: "Noah Bennett",
        initials: "NB",
        color: palette[2],
        status: "Online",
        unread: true,
        time: "Yesterday",
        snippet: "These two markets are correlated â€” could run a small hedge.",
        messages: [
          { from: "them", text: "Two markets basically the same story. If one moves, the other should follow.", time: "Yesterday" },
          { from: "me", text: "Thinking long laggard / short leader? Like a tiny pairs trade?", time: "Yesterday" },
          { from: "them", text: "Yeah. Edge is small but cleaner. Main risk is correlation breaks on new info.", time: "Yesterday" },
          { from: "me", text: "Then cap size and close if thesis is invalid. Donâ€™t average down blindly.", time: "Yesterday" }
        ]
      },
      {
        id: "chloe",
        name: "Chloe Winters",
        initials: "CW",
        color: palette[5],
        status: "Offline",
        unread: false,
        time: "Mon",
        snippet: "Before buying: what would make you change your mind?",
        messages: [
          { from: "them", text: "Everyone asks 'should we buy?' but nobody defines invalidation.", time: "Mon" },
          { from: "me", text: "Facts. If you canâ€™t name what breaks the thesis, itâ€™s not a trade.", time: "Mon" },
          { from: "them", text: "Exactly. Also: donâ€™t chase a move. Better entry > forced entry.", time: "Mon" },
          { from: "me", text: "Or accept you missed it. Missing is cheaper than revenge trading.", time: "Mon" }
        ]
      },
      {
        id: "liam",
        name: "Liam Parker",
        initials: "LP",
        color: palette[7],
        status: "Online",
        unread: false,
        time: "Sun",
        snippet: "This is pure news-risk â€” play it like an event, not a long hold.",
        messages: [
          { from: "them", text: "This market is waiting for one announcement. Until then itâ€™s noise.", time: "Sun" },
          { from: "me", text: "So it moves in a single candle. Timing + orders matter.", time: "Sun" },
          { from: "them", text: "Plan: starter position now, add only on confirmation.", time: "Sun" },
          { from: "me", text: "Good. If it gaps against you, cut it. Donâ€™t marry positions.", time: "Sun" }
        ]
      }
    ];

    // 2) Friend requests
    const requests = [
      { id: "olivia", name: "Olivia Brooks", initials: "OB", color: palette[3], mutuals: "3 mutuals", note: "Hey â€” saw your risk thread. Can we connect?" },
      { id: "daniel", name: "Daniel Carter", initials: "DC", color: palette[4], mutuals: "1 mutual", note: "Loved your take on trend vs noise. DM?" },
      { id: "sophie", name: "Sophie Lane", initials: "SL", color: palette[6], mutuals: "2 mutuals", note: "Requesting to connect." }
    ];

    // 3) Communities (Reddit-style)
    const communities = [
      {
        id: "sports",
        name: "Sports",
        initials: "SP",
        color: palette[5],
        members: "128k members",
        snippet: "Injury rumors moving odds fast â€” beware thin books.",
        posts: [
          { title: "NBA futures â€” is the injury move an overreaction?", meta: "Hot â€¢ 12m ago", text: "Odds swung hard off one tweet. Anyone got a credible confirmation? If itâ€™s unverified, Iâ€™m considering a small fade with strict risk.", up: 312, comments: 84 },
          { title: "Risk note: niche leagues = wide spreads", meta: "New â€¢ 35m ago", text: "Small markets can look like 'free money' but slippage kills. If you canâ€™t exit cleanly, donâ€™t enter big.", up: 190, comments: 41 }
        ]
      },
      {
        id: "politics",
        name: "Politics",
        initials: "PO",
        color: palette[3],
        members: "210k members",
        snippet: "Debate week soon â€” volatility + headline risk.",
        posts: [
          { title: "Debate week sizing: how are you managing risk?", meta: "Top â€¢ 1h ago", text: "Debate nights are pure headline risk. Iâ€™m reducing exposure and keeping only positions with clear invalidation points + limit exits.", up: 540, comments: 132 },
          { title: "Trend vs noise: source quality matters", meta: "New â€¢ 2h ago", text: "If the source isnâ€™t credible, I treat the move as temporary. Waiting for confirmation usually saves me from whipsaws.", up: 260, comments: 67 }
        ]
      },
      {
        id: "ai-tech",
        name: "AI / Tech",
        initials: "AI",
        color: palette[2],
        members: "95k members",
        snippet: "Earnings + product launches = big catalyst week.",
        posts: [
          { title: "Catalyst calendar (earnings / launches / key dates)", meta: "Pinned â€¢ 3h ago", text: "Drop dates that can move markets. Share what youâ€™re watching + why it matters (and what would invalidate your thesis).", up: 820, comments: 203 },
          { title: "Trade idea: momentum but with strict risk", meta: "Hot â€¢ 18m ago", text: "Trend is up but crowded. Iâ€™m only taking breakouts with defined stop + scaling out into spikes. No chasing.", up: 410, comments: 96 }
        ]
      }
    ];

    let activeTab = "all";
    let activeChatId = null;
    let activeCommunityId = null;

    const chatListEl = document.getElementById("chatList");
    const chatMessagesEl = document.getElementById("chatMessages");
    const chatHeaderEl = document.getElementById("chatHeader");
    const chatInputEl = document.getElementById("chatInput");
    const peerAvatarEl = document.getElementById("peerAvatar");
    const peerNameEl = document.getElementById("peerName");
    const peerStatusEl = document.getElementById("peerStatus");
    const peerDotEl = document.getElementById("peerDot");
    const chatSearchEl = document.getElementById("chatSearch");
    const messageInputEl = document.getElementById("messageInput");

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
      }[m]));
    }

    function renderMessages(chat) {
      const html = chat.messages.map(m => {
        const side = m.from === "me" ? "me" : "them";
        const check = m.from === "me"
          ? `<span class="read-check" title="Read"><i class="fas fa-check-double"></i></span>`
          : "";
        return `
          <div class="msg-row ${side}">
            <div class="msg-bubble">
              <div class="msg-text">${escapeHtml(m.text)}</div>
              <div class="msg-time">${escapeHtml(m.time)} ${check}</div>
            </div>
          </div>
        `;
      }).join("");

      chatMessagesEl.innerHTML = html || "";
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    function renderCommunityFeed(community) {
      const postsHtml = community.posts.map(p => `
        <div class="post-card">
          <div class="post-top">
            <div class="post-title">${escapeHtml(p.title)}</div>
            <div class="post-meta">${escapeHtml(p.meta)}</div>
          </div>
          <div class="post-body">${escapeHtml(p.text)}</div>
          <div class="post-actions">
            <button class="mini-btn" type="button">â–² ${p.up}</button>
            <button class="mini-btn" type="button">ðŸ’¬ ${p.comments}</button>
            <button class="mini-btn" type="button">Share</button>
          </div>
        </div>
      `).join("");

      chatMessagesEl.innerHTML = `<div class="community-feed">${postsHtml}</div>`;
      chatMessagesEl.scrollTop = 0;
    }

    function openChat(chatId) {
      activeChatId = chatId;
      activeCommunityId = null;

      const chat = chats.find(c => c.id === chatId);
      if (!chat) return;

      chat.unread = false;

      chatHeaderEl.style.display = "flex";
      chatInputEl.style.display = "block";

      peerAvatarEl.textContent = chat.initials;
      peerAvatarEl.style.background = chat.color;
      peerNameEl.textContent = chat.name;

      peerStatusEl.textContent = chat.status;

      // Status dot styles for light theme
      const status = chat.status.toLowerCase();
      if (status === "offline") {
        peerDotEl.style.background = "rgba(15,23,42,0.25)";
        peerDotEl.style.boxShadow = "0 0 0 4px rgba(15,23,42,0.06)";
      } else if (status === "away") {
        peerDotEl.style.background = "var(--warning)";
        peerDotEl.style.boxShadow = "0 0 0 4px rgba(245,158,11,0.14)";
      } else {
        peerDotEl.style.background = "var(--accent)";
        peerDotEl.style.boxShadow = "0 0 0 4px rgba(16,185,129,0.14)";
      }

      renderList();
      renderMessages(chat);
      messageInputEl.focus();
    }

    function openCommunity(communityId) {
      activeCommunityId = communityId;
      activeChatId = null;

      const community = communities.find(c => c.id === communityId);
      if (!community) return;

      // show header, but keep input hidden (community is feed-style)
      chatHeaderEl.style.display = "flex";
      chatInputEl.style.display = "none";

      peerAvatarEl.textContent = community.initials;
      peerAvatarEl.style.background = community.color;
      peerNameEl.textContent = community.name;

      peerStatusEl.textContent = community.members;
      peerDotEl.style.background = "var(--primary)";
      peerDotEl.style.boxShadow = "0 0 0 4px rgba(37, 99, 235, 0.12)";

      renderList();
      renderCommunityFeed(community);
    }

    function renderList() {
      const q = chatSearchEl.value.trim().toLowerCase();

      if (activeTab === "all") {
        const filtered = chats.filter(c => c.name.toLowerCase().includes(q));
        chatListEl.innerHTML = filtered.map(c => {
          const isActive = c.id === activeChatId;
          const classes = ["chat-item", isActive ? "active" : "", c.unread ? "unread" : ""].join(" ").trim();
          return `
            <button class="${classes}" data-chat-id="${c.id}">
              <div class="chat-avatar" style="background:${c.color};">${escapeHtml(c.initials)}</div>
              <div class="chat-item-main">
                <div class="chat-item-top">
                  <div class="chat-name">${escapeHtml(c.name)}</div>
                  <div class="chat-time">${escapeHtml(c.time)}</div>
                </div>
                <div class="chat-snippet">${escapeHtml(c.snippet)}</div>
              </div>
              <div class="chat-badge"></div>
            </button>
          `;
        }).join("") || `<div style="padding:14px;color:var(--chat-muted);font-weight:700;">No conversations found.</div>`;

        chatListEl.querySelectorAll("[data-chat-id]").forEach(btn => {
          btn.addEventListener("click", () => openChat(btn.getAttribute("data-chat-id")));
        });

      } else if (activeTab === "community") {
        const filtered = communities.filter(c => c.name.toLowerCase().includes(q));
        chatListEl.innerHTML = filtered.map(c => {
          const isActive = c.id === activeCommunityId;
          const classes = ["chat-item", isActive ? "active" : ""].join(" ").trim();
          return `
            <button class="${classes}" data-community-id="${c.id}">
              <div class="chat-avatar" style="background:${c.color};">${escapeHtml(c.initials)}</div>
              <div class="chat-item-main">
                <div class="chat-item-top">
                  <div class="chat-name">${escapeHtml(c.name)}</div>
                  <div class="chat-time">${escapeHtml(c.members)}</div>
                </div>
                <div class="chat-snippet">${escapeHtml(c.snippet)}</div>
              </div>
            </button>
          `;
        }).join("") || `<div style="padding:14px;color:var(--chat-muted);font-weight:700;">No communities found.</div>`;

        chatListEl.querySelectorAll("[data-community-id]").forEach(btn => {
          btn.addEventListener("click", () => openCommunity(btn.getAttribute("data-community-id")));
        });

      } else {
        const filtered = requests.filter(r => r.name.toLowerCase().includes(q));
        chatListEl.innerHTML = filtered.map(r => {
          return `
            <div style="padding:8px;">
              <div style="border:1px solid var(--chat-border);background:var(--chat-surface);border-radius:16px;padding:12px;box-shadow:0 10px 18px -16px rgba(15,23,42,0.12);">
                <div style="display:flex;align-items:center;gap:12px;">
                  <div class="chat-avatar" style="background:${r.color};width:46px;height:46px;">${escapeHtml(r.initials)}</div>
                  <div style="flex:1;min-width:0;">
                    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
                      <div style="font-weight:900;color:var(--chat-text);font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                        ${escapeHtml(r.name)}
                      </div>
                      <div style="font-size:0.8rem;font-weight:800;color:var(--chat-muted);white-space:nowrap;">
                        ${escapeHtml(r.mutuals)}
                      </div>
                    </div>
                    <div style="margin-top:2px;color:var(--chat-muted);font-weight:650;font-size:0.92rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                      ${escapeHtml(r.note)}
                    </div>
                  </div>
                </div>
                <div class="request-row">
                  <button class="ghost-button" data-accept="${r.id}">Accept</button>
                  <button class="danger-button" data-decline="${r.id}">Decline</button>
                </div>
              </div>
            </div>
          `;
        }).join("") || `<div style="padding:14px;color:var(--chat-muted);font-weight:700;">No requests found.</div>`;

        chatListEl.querySelectorAll("[data-accept]").forEach(btn => {
          btn.addEventListener("click", () => alert("Request accepted."));
        });

        chatListEl.querySelectorAll("[data-decline]").forEach(btn => {
          btn.addEventListener("click", () => alert("Request declined."));
        });
      }
    }

    function setTab(tab) {
      activeTab = tab;

      document.querySelectorAll(".chat-tab").forEach(t => {
        const isActive = t.getAttribute("data-tab") === tab;
        t.classList.toggle("active", isActive);
        t.setAttribute("aria-selected", isActive ? "true" : "false");
      });

      // Reset selections when switching major modes
      if (tab === "all") {
        activeCommunityId = null;

        if (!activeChatId) {
          chatHeaderEl.style.display = "none";
          chatInputEl.style.display = "none";
          chatMessagesEl.innerHTML = `
            <div class="chat-empty">
              <div class="empty-card">
                <div class="empty-title">Pick a conversation</div>
                <div class="empty-subtitle">Choose a friend on the left to start chatting.</div>
              </div>
            </div>
          `;
        }

      } else if (tab === "requests") {
        activeChatId = null;
        activeCommunityId = null;

        chatHeaderEl.style.display = "none";
        chatInputEl.style.display = "none";
        chatMessagesEl.innerHTML = `
          <div class="chat-empty">
            <div class="empty-card">
              <div class="empty-title">Friend requests</div>
              <div class="empty-subtitle">Accept or decline requests from the left panel.</div>
            </div>
          </div>
        `;

      } else if (tab === "community") {
        activeChatId = null;

        // If no community selected yet, show placeholder
        if (!activeCommunityId) {
          chatHeaderEl.style.display = "none";
          chatInputEl.style.display = "none";
          chatMessagesEl.innerHTML = `
            <div class="chat-empty">
              <div class="empty-card">
                <div class="empty-title">Pick a community</div>
                <div class="empty-subtitle">Choose Sports, Politics, or AI / Tech on the left.</div>
              </div>
            </div>
          `;
        } else {
          const community = communities.find(c => c.id === activeCommunityId);
          if (community) openCommunity(activeCommunityId);
        }
      }

      renderList();
    }

    function sendMessage() {
      if (!activeChatId) return;
      const chat = chats.find(c => c.id === activeChatId);
      if (!chat) return;

      const text = messageInputEl.value.trim();
      if (!text) return;

      const now = new Date();
      const h = now.getHours();
      const m = String(now.getMinutes()).padStart(2, "0");
      const ampm = h >= 12 ? "PM" : "AM";
      const hour12 = ((h + 11) % 12) + 1;
      const time = `${hour12}:${m} ${ampm}`;

      chat.messages.push({ from: "me", text, time });
      chat.snippet = text;
      chat.time = "Now";

      messageInputEl.value = "";
      renderList();
      renderMessages(chat);
    }

    // Events
    document.querySelectorAll(".chat-tab").forEach(tab => {
      tab.addEventListener("click", () => setTab(tab.getAttribute("data-tab")));
    });

    chatSearchEl.addEventListener("input", renderList);

    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    messageInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    document.getElementById("settingsBtn").addEventListener("click", () => {
      alert("Chat settings would open here.");
    });

    document.getElementById("newMsgBtn").addEventListener("click", () => {
      alert("New message flow would open here.");
    });

    document.getElementById("chatInfoBtn").addEventListener("click", () => {
      alert("Info panel would open here.");
    });

    document.getElementById("chatFindBtn").addEventListener("click", () => {
      alert("Search within chat would open here.");
    });

    document.getElementById("attachBtn").addEventListener("click", () => {
      alert("Attachment picker would open here.");
    });

    document.getElementById("emojiBtn").addEventListener("click", () => {
      alert("Emoji picker would open here.");
    });

    document.querySelector(".upgrade-button").addEventListener("click", () => {
      alert("Upgrade flow would open here.");
    });

    // Initial render
    renderList();
  </script>
</body>

</html>
